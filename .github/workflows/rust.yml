name: 🧪 Test cr8s Code

on:
 push:
   branches: [ main ]
 pull_request:
   branches: [ main ]
 workflow_dispatch:

permissions:
 contents: read

jobs:
 test:
   name: Test cr8s Code
   runs-on: ubuntu-latest

   steps:
     - name: ⬇️ Checkout repository
       uses: actions/checkout@v4

     - name: 🛠️ Setup Rust
       uses: actions-rust-lang/setup-rust-toolchain@v1
       with:
         components: rustfmt, clippy

     - name: 📋 Format check
       run: cargo fmt --check

     - name: 🔍 Lint check
       run: cargo clippy --release --all-targets --all-features -- -D warnings

     - name: 🔒 Security audit
       run: cargo audit || cargo outdated || true

     - name: 🧪 Run tests
       run: cargo test --release --all-targets --all-features

     - name: 🛠️ Build binaries
       run: cargo build --release --bin server --bin cli

